# 下面脚本是用于测试本机与11.11.11.0/24网段的11.11.11.1-11.11.11.15的任意设备的连通性，并在连续15分钟无法访问时重启本机。
``` shell
#!/bin/bash

RESTART_COUNT=0
MAX_RESTART_COUNT=15

# 获取本机除了属于11.11.11.0/24网段的IP的IP
LOCAL_IP=$(ip -o -4 addr list | grep -v 11.11.11 | awk '{print $4}' | cut -d/ -f1)

while true; do
    for i in {1..15}; do
        if ping -c 1 11.11.11.$i >/dev/null; then
            echo "Connected to 11.11.11.$i"
            RESTART_COUNT=0
            break
        fi

        if [ $i -eq 15 ]; then
            echo "Unable to connect to 11.11.11.1-11.11.11.15"
            ((RESTART_COUNT++))
        fi
    done

    if [ $RESTART_COUNT -eq $MAX_RESTART_COUNT ]; then
        echo "Restarting the system..."
        reboot
    fi

    sleep 60
done

```
修改后的脚本通过ip命令获取本机属于11.11.11.0/24网段的I，并将其保存在变量LOCAL_IP中。然后，在测试连通性时，会跳过这些本机IP。
请按照之前的步骤将脚本设置为系统的启动项，并确保以root权限运行脚本。
这样，脚本将测试本机与11.11.11.0/24网段的11.11.11.1-11.11.11.15的任意设备的连通性，并在连续15分钟无法访问时重启本机。

要使该脚本在系统重启后自动执行，可以将脚本放置在/etc/init.d/目录下，并设置执行权限。

``` shell
sudo cp auto-restart.sh  /etc/init.d/
sudo chmod +x /etc/init.d/auto-restart.sh 
```

然后，可以使用update-rc.d命令将脚本添加到系统启动项中。

``` shell
sudo update-rc.d auto-restart.sh  defaults
```
现在，每次系统重启后，脚本就会自动执行。


请注意，为了能够在脚本中执行重启操作，需要以root权限运行脚本。可以使用sudo命令来运行脚本，或者将脚本添加到root用户的启动项中。

